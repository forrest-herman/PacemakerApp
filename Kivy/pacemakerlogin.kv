#:kivy 1.11.1

<WelcomeWindow>:
    name: "welcomeWin"

    
    FloatLayout:
        size: root.width-400, root.height-200
        Label: 
            text: "Welcome to the Pacemaker GUI"
            font_size: 25*root.width/600
            pos_hint: {"center_x":0.5, "y":0.2}
        
        ## Login
        Button:
            text:"Login"
            size_hint: 0.3,0.1
            pos_hint: {"center_x":0.5, "top":0.45}  ##The keys ‘x’, ‘right’ and ‘center_x’ will use the parent width. The keys ‘y’, ‘top’ and ‘center_y’ will use the parent height.
            
            on_release: 
                # app.root.current = "second" if passw.text == "pace" else "main"
                # app.root.current = "loginWin"
                # root.manager.transition.direction = "up"
                root.goToLogin()
                

        ## Register
        Button:
            text:"Register"
            size_hint: 0.3,0.1
            pos_hint: {"center_x":0.5, "top":0.3}

            on_release:
                root.goToReg()


<LoginWindow>:
    name: "loginWin"

    nameField: nameField
    passwField: password


    FloatLayout:
        size_hint: 0.4,0.7
        pos_hint: {"center_x":0.5,"center_y":0.5}


        BoxLayout:
            orientation: "vertical"
            spacing: 30
            # padding: 0, 100 #padding_horizontal, padding_vertical
            pos_hint: {"center_x":0.5,"center_y":0.5}

            BoxLayout:
                orientation: "vertical"
                size_hint_y: 0.6
                Label:
                    text: "Returning User\nPlease Enter Your Details"
                    halign: 'center'
                    valign: 'top'
                    font_size: 27*root.width/800
                    size_hint: 1,0.1
                    # pos_hint: {"center_x":0.5, "center_y":0.8}

                Label:
                    text: "Username: "
                    font_size: 15
                    size_hint_x: None
                    size_hint_y: 0.08
                    pos_hint: {'left': 1}
                
                TextInput:
                    id:nameField
                    multiline:False
                    size_hint: 1,0.06
                    # pos_hint: {"center_x":0.5, "center_y":0.55}

                Label:
                    text: "Password: "
                    font_size: 15
                    size_hint_x: None
                    size_hint_y: 0.08
                    pos_hint: {'left': 1}

                TextInput:
                    id: password
                    multiline:False
                    size_hint: 1,0.06
                    # pos_hint: {"center_x":0.5, "center_y":0.35}

            BoxLayout:
                orientation: "vertical"
                spacing: 10
                size_hint_y: 0.25

                Button:
                    text:"Login"
                    size_hint: 1,0.1
                    # pos_hint: {"center_x":0.5, "center_y":0.2}
                    on_press: root.btnLogin()

                Button:
                    text:"Back"
                    size_hint: 1,0.1
                    # pos_hint: {"center_x":0.5, "center_y":0.1}
                    on_press: root.btnBack()


<RegisterWindow>:
    name: "registerWin"

    firstName_Field: firstName
    lastName_Field: lastName
    username_Field: username
    password_Field: password

    FloatLayout:
        size_hint: 0.4,0.7
        pos_hint: {"center_x":0.5,"center_y":0.5}


        BoxLayout:
            orientation: "vertical"
            spacing: 30
            pos_hint: {"center_x":0.5,"center_y":0.5}

            Label:
                text: "Create Your Account"
                halign: 'center'
                valign: 'top'
                font_size: 27*root.width/800
                size_hint: 1,0.1


            BoxLayout:
                orientation: "vertical"
                size_hint_y: 0.6
                spacing: 10
                

                ## First + Last Name

                GridLayout:
                    cols: 2
                    rows: 2
                    spacing: [10,0]
                    size_hint_x: 1
                    size_hint_y: None
                    height: 60

                    Label:
                        text: "First Name: "
                        font_size: 15
                        #size_hint_x: None
                        height: 30
                        pos_hint: {'left': 1}
                        size_hint_x: None
                    
                    Label:
                        text: "Last Name: "
                        font_size: 15
                        height: 30
                        pos_hint: {'left': 1}
                        size_hint_x: None

                    TextInput:
                        id:firstName
                        multiline:False
                        size_hint: 0.5, None
                        height: 30

                    TextInput:
                        id:lastName
                        multiline:False
                        size_hint: 0.5, None
                        height: 30
                

                ## Username

                GridLayout:
                    cols: 1
                    rows: 2
                    size_hint_x: 1
                    size_hint_y: None
                    height: 60

                    Label:
                        text: "Username: "
                        font_size: 15
                        height: 30
                        pos_hint: {'left': 1}
                        size_hint_x: None
                    
                    TextInput:
                        id:username
                        multiline:False
                        size_hint: 1,None
                        height: 30
                


                ## Password

                GridLayout:
                    cols: 1
                    rows: 2
                    size_hint_x: 1
                    size_hint_y: None
                    height: 60

                    Label:
                        text: "Password: "
                        font_size: 15
                        height: 30
                        pos_hint: {'left': 1}
                        size_hint_x: None

                    TextInput:
                        id: password
                        multiline:False
                        size_hint: 1,None
                        height: 30

            BoxLayout:
                orientation: "vertical"
                spacing: 10
                size_hint_y: 0.25

                Button:
                    text:"Register"
                    size_hint: 1,0.1
                    on_press: root.regUser()

                Button:
                    text:"Back"
                    size_hint: 1,0.1
                    on_press: root.btnBack()



<MainWindow>:
    name: "mainWin"
    
    currentUser: currentUser
    device:device
    display_active_pacingMode:pacingMode_text

    display_LRL_parameter:LRL_parameterText
    display_MSR_parameter:MSR_parameterText
    display_AtrAmp_parameter:AtrAmp_parameterText
    display_VentAmp_parameter:VentAmp_parameterText
    display_AtrPulseWidth_parameter:AtrPulseWidth_parameterText
    display_VentPulseWidth_parameter:VentPulseWidth_parameterText
    display_ARP_parameter:ARP_parameterText
    display_VRP_parameter:VRP_parameterText
    display_AtrSens_parameter:AtrSens_parameterText
    display_VentSens_parameter:VentSens_parameterText
    display_reactionTime_parameter:reactionTime_parameterText
    display_recoveryTime_parameter:recoveryTime_parameterText
    display_AVDelay_parameter:AVDelay_parameterText
    display_resFactor_parameter:resFactor_parameterText
    display_AccThreshold1_parameter:AccThreshold1_parameterText
    display_AccThreshold2_parameter:AccThreshold2_parameterText
    display_AccThreshold3_parameter:AccThreshold3_parameterText


    #display_heartbeat_bpm:heartBPM_text  ####  for later


    FloatLayout:
        ## Current user displayed
        GridLayout:
            cols: 5
            size_hint: 0.7,0.05
            y: root.height-self.height-2
            pos_hint: {"center_x": 0.5}
            
            canvas:
                Color:
                    rgba: 0.1, 0.1, 0.1, 1
                Rectangle:
                    size: root.width*2,self.height+10
                    pos: self.x-self.width,self.y
            
            Label:
                text: ""
                font_size: 18
                width: 10

            Label:
                id:currentUser
                text: ""
                font_size: 18
                width: 10

            Label:
                text: "\u2022"
                color: root.indicatorColour
                font_size: 35
            
            Label:
                id:device
                text: ""
                font_size: 18
                width: 10
            
            Button:
                text: "Connect"
                size_hint_x: 0.6
                on_press: root.serialConnectMain()

                

        ## Logout Button top right
        Button:
            text: "Logout"
            size_hint: 0.1,0.05
            pos: root.width-self.width-2,root.height-self.height-2
            on_press: root.logout()
            on_press: root.reset()

        ## Delete Account Button top left
        Button:
            text: "Delete Account"
            size_hint: 0.15,0.05
            pos: 2,root.height-self.height-2
            on_press: root.deleteAccount()

        ## Main App functions here:   ----------------------------------------------------

        # Pacing mode details
        GridLayout:
            cols: 2
            size_hint: 1,0.2
            pos_hint: {"center_x":0.5,"top":0.88}
            padding: 70,0
            spacing: 30
            Label:
                canvas.before:
                    Color:
                        rgba: 0.1, 0.1, 0.1, 1
                    Rectangle:
                        size: self.width,self.height
                        pos: self.x,self.y
                id:pacingMode_text
                text: ""
                font_size: 18
                

            ## Mode Selector Button
            Button:
                text: "Choose Pacing Mode"
                pos_hint: {"center_x":0.5,"top":0.85}
                on_press: root.open_modeSelector()

            ## Programmable Parameters Button
            Button:
                text: "Change Programmable Parameters"
                #size_hint: 0.4,1
                pos_hint: {"center_x":0.5, "top":0.75}
                on_press: root.open_programmableParameters()

            ## Load Previous Button 
            Button:
                text: "Load Previous"
                #size_hint:0.2,0.08
                pos_hint: {"center_x":0.6, "top":0.13}
                on_press: root.loadPrevious()
        

        ## GridLayout Bottom ----------
        GridLayout:
            size_hint:1,0.08
            pos_hint: {"center_x":0.5, "top":0.13}
            cols:2
            spacing: 30
            padding: 100,0

            ## Deploy Button 
            Button:
                text: "Deploy Parameters"
                #size_hint:0.2,0.08
                #pos_hint: {"center_x":0.4, "top":0.13}
                on_press: root.deploy()
                #on_press: root.load_data()
                #on_press: root.save_data()
            
            ## Heartbeat Graph Button
            Button:
                text: "Open Heartbeat Graph"
                #size_hint: 0.4,0.08
                #pos_hint: {"center_x":0.5, "top":0.13}
                on_press: root.open_heartbeatGraph()
           
        ## Save Button 
        #Button:
        #    text: "Save Parameters"
        #    size_hint:0.2,0.1
        #    pos_hint: {"center_x":1, "top":0.13}
        #    on_press: root.save()


        ## Display all programmable parameters -------------------------------
        
        GridLayout:
            cols: 2
            size_hint: 0.85,0.3
            pos_hint: {"center_x":0.5,"top":0.6}
            spacing: 20,0
        
            Label:
                id:LRL_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5
                background_color: 0, 1, 1, 1

            Label:
                id:MSR_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5
                background_color: 1, 1, 1, 1

            Label:
                id:AtrAmp_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5

            Label:
                id:VentAmp_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5

            Label:
                id:AtrPulseWidth_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5

            Label:
                id:VentPulseWidth_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5


            Label:
                id:ARP_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5


            Label:
                id:VRP_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5
            
            Label:
                id:AtrSens_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5
            
            Label:
                id:VentSens_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5
            
            Label:
                id:reactionTime_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5
            
            Label:
                id:recoveryTime_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5
            
            Label:
                id:AVDelay_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5
            
            Label:
                id:resFactor_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5
        
        GridLayout:
            cols: 3
            size_hint: 0.85,0.3
            pos_hint: {"center_x":0.5,"top":0.4}
            spacing: 20,0

            Label:
                id:AccThreshold1_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5
            
            Label:
                id:AccThreshold2_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5
            
            Label:
                id:AccThreshold3_parameterText
                text: ""
                font_size: 18
                halign: 'left'
                pos_hint: {'x': 0}
                size_hint_x: 0.5



        ## BPM Display for later
        # GridLayout:
        #     pos_hint: {"center_x":0.5, "top":0.3}
        #     Label:
        #         id:heartBPM_text
        #         text: ""
        #         font_size: 18
        #         halign: 'center'

                

<modeSelectorPopup>:
    FloatLayout:
        pos_hint: {"center_x":0.5, "center_y":0.5}
        
        GridLayout:
            rows:2
            pos_hint: {"center_x":0.5, "center_y":0.5}
            size_hint: 0.5, 0.9
            spacing: 30

            GridLayout:
                size_hint_y: 0.9
                rows: 11 # number of modes
                spacing: 10
                
                Button:
                    text:"AOO"
                    ## create var to track selected mode
                    on_press: 
                        root.setPacingMode("AOO")
                        root.closePopup()

                Button:
                    text:"VOO"
                    on_press: 
                        root.setPacingMode("VOO")
                        root.closePopup()

                Button:
                    text:"AAI"
                    on_press: 
                        root.setPacingMode("AAI")
                        root.closePopup()

                Button:
                    text:"VVI"
                    on_press: 
                        root.setPacingMode("VVI")
                        root.closePopup()
                
                Button:
                    text:"DOO"
                    on_press: 
                        root.setPacingMode("DOO")
                        root.closePopup()
                
                Button:
                    text:"AOOR"
                    on_press: 
                        root.setPacingMode("AOOR")
                        root.closePopup()
                
                Button:
                    text:"VOOR"
                    on_press: 
                        root.setPacingMode("VOOR")
                        root.closePopup()

                Button:
                    text:"DOOR"
                    on_press: 
                        root.setPacingMode("DOOR")
                        root.closePopup()
                
                Button:
                    text:"AAIR"
                    on_press: 
                        root.setPacingMode("AAIR")
                        root.closePopup()
                
                Button:
                    text:"VVIR"
                    on_press: 
                        root.setPacingMode("VVIR")
                        root.closePopup()

                Button:
                    text:"DDDR"
                    on_press: 
                        root.setPacingMode("DDDR")
                        root.closePopup()


            GridLayout:
                rows:1
                size_hint_y: 0.1

                Button:
                    text:"Cancel"
                    on_release: root.closePopup()

<heartbeatGraphPopup>:
    FloatLayout:
        pos_hint: {"center_x":0.5, "center_y":0.5}

        GridLayout:
            rows:2
            pos_hint: {"center_x":0.5, "center_y":0.5}
            size_hint: 1,1

            GridLayout:
                size_hint_y: 3
                rows: 3
                spacing: 5

                Graph:
                    id: graphAtr

                    xlabel: "Time (ms)"       
                    xmin: 0
                    xmax: 150
                    #x_ticks_major:50
                    #x_grid_label: True

                    ylabel: "Voltage"
                    ymin:-3.3
                    ymax:3.3
                    y_ticks_major:1
                    y_grid_label: True

                    tick_color: [1, 1, 1, 1]

                Graph:
                    id: graphVent

                    xlabel: "Time (ms)"       
                    xmin: 0
                    xmax: 150
                    #x_ticks_major:50
                    #x_grid_label: True

                    ylabel: "Voltage"
                    ymin:-3.3
                    ymax:3.3
                    y_ticks_major:1
                    y_grid_label: True

                    tick_color: [1, 1, 1, 1]
            GridLayout:
                size_hint_y: 0.4
                rows: 1
                spacing: 8
                    
                Button:
                    text:"Start"
                    on_press: 
                        root.startHeartbeat()

                Button:
                    text:"Close"
                    on_release:
                        root.closePopup()
                        root.stopHeartbeat()
                    


<programmableParametersPopup>:
    FloatLayout:
        pos_hint: {"center_x":0.5, "center_y":0.5}
        #size_hint: 0.9,0.9
        
        GridLayout:
            rows:2
            pos_hint: {"center_x":0.5, "center_y":0.5}
            size_hint: 0.9, 1
            spacing: 10
            padding: 10

            GridLayout:
                size_hint_y: 0.92
                #rows: 17 # number of programmable parameters
                cols: 2
                spacing: 7
                
                Button:
                    text:"Lower Rate Limit"
                    on_press: 
                        root.setIndex(1) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired LRL value")

                Button:
                    text:"Maximum Sensor Rate"
                    on_press: 
                        root.setIndex(2) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired MSR value")

                Button:
                    text:"Atrial Amplitude"
                    on_press: 
                        root.setIndex(3) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired Atrial Amplitude")

                Button:
                    text:"Ventrical Amplitude"
                    on_press: 
                        root.setIndex(6) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired Ventrical Amplitude")

                Button:
                    text:"Atrial Pulse Width"
                    on_press: 
                        root.setIndex(4) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired Atrial Pulse Width")

                Button:
                    text:"Ventrical Pulse Width"
                    on_press: 
                        root.setIndex(7) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired Ventrical Pulse Width")

                Button:
                    text:"Atrium Refractory Period"
                    on_press: 
                        root.setIndex(5) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired ARP value")

                Button:
                    text:"Ventricle Refractory Period"
                    on_press: 
                        root.setIndex(8) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired VRP value")
                
                Button:
                    text:"Atrium Sensitivity"
                    on_press: 
                        root.setIndex(9) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired AtrSens value")
                
                Button:
                    text:"Ventricle Sensitivity"
                    on_press: 
                        root.setIndex(10) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired VentSens value")
                
                Button:
                    text:"Reaction Time"
                    on_press: 
                        root.setIndex(11) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired reaction time value")
                
                Button:
                    text:"Recovery Time"
                    on_press: 
                        root.setIndex(12) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired Recovery Time value")
                
                Button:
                    text:"AV Delay"
                    on_press: 
                        root.setIndex(13) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired AV Delay value")
                
                Button:
                    text:"Response Factor"
                    on_press: 
                        root.setIndex(14) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired Response Factor value")
                
                Button:
                    text:"Still Threshold"
                    on_press: 
                        root.setIndex(15) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired Still Threshold value")
                
                Button:
                    text:"Walking Threshold"
                    on_press: 
                        root.setIndex(16) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired Walking Threshold value")
                
                Button:
                    text:"Running Threshold"
                    on_press: 
                        root.setIndex(17) #index to keep track of which button was pressed
                        root.open_textInput("Please enter desired Running Threshold value")


            GridLayout:
                rows:1
                size_hint_y: 0.08

                Button:
                    text:"Done"
                    on_press: root.closePopup()

<textInputPopup>:

    inputField: textIn

    FloatLayout:
        pos_hint: {"center_x":0.5, "center_y":0.5}

        GridLayout:
            size_hint: 0.6, 0.9
            pos_hint: {"center_x":0.5, "center_y":0.5}
            rows: 3 
            spacing: 10
            height: 20
            padding: 0,35

            # Text input
            TextInput:
                id:textIn
                multiline:False

            # Input values from text field
            Button:
                text:"Set Value"
                on_release: 
                    root.selectProgParam()
                    root.closePopup()
            
            # Cancel
            Button:
                text:"Cancel"
                on_release:
                    root.closePopup()

<errorPopup>:
    size:400,300
    Label:
        text: "Invalid username or password"
        size_hint:0.6,0.2
        pos_hint: {"x":0.2, "center_y":0.7}

    Button:
        text:"Ok"
        size_hint:0.6,0.3
        pos_hint: {"x":0.2, "top":0.4}
        on_press: root.closePopup()

<genericErrorPopup>:
    size:400,300
    Label:
        text: "Attempt Failed"
        size_hint:0.6,0.2
        pos_hint: {"x":0.2, "center_y":0.7}

    Button:
        text:"Ok"
        size_hint:0.6,0.3
        pos_hint: {"x":0.2, "top":0.4}
        on_press: root.closePopup()

<paramErrorPopup>:
    size:500,400
    Label:
        text: "Given value is not acceptable"
        size_hint:0.3,0.2
        pos_hint: {"x":0.35, "center_y":0.7}
    
    Button:
        text: "Ok"
        size_hint:0.6,0.3
        pos_hint: {"x":0.2, "top":0.4}
        on_press: root.closePopup()

<errorMaxPopup>:
    size:400,300
    Label:
        text: "Saved Account Limit Reached. \nA maximum of 10 accounts can be stored locally."
        # size_hint:0.6,0.2
        text_size: root.width-25, None
        multiline:True
        halign: 'center'
        pos_hint: {"center_x":0.5, "center_y":0.7}

    Button:
        text:"Ok"
        size_hint:0.6,0.3
        pos_hint: {"center_x":0.5, "top":0.4}
        on_release: root.closePopup()


<successPopup>:
    size:400,300
    Label:
        text: "Success!"
        halign: 'center'
        size_hint:0.6,0.2
        pos_hint: {"center_x":0.5, "center_y":0.5}

